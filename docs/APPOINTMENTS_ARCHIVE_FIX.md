# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ appointments

**–î–∞—Ç–∞:** 02.09.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π  

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ü–∏–µ–Ω—Ç–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–∞—Ü–∏–µ–Ω—Ç–∞: no such column: appointments_appointmentevent.archived_by_id
```

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤—ã–∑–≤–∞–Ω–∞ —Ç–µ–º, —á—Ç–æ –º–æ–¥–µ–ª—å `AppointmentEvent` –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ `appointments` –Ω–µ –±—ã–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è. –ú–æ–¥–µ–ª—å –Ω–∞—Å–ª–µ–¥–æ–≤–∞–ª–∞—Å—å –æ—Ç `ArchivableModel`, –Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ —Å—Ç–∞—Ä—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä `NotArchivedManager` –≤–º–µ—Å—Ç–æ –Ω–æ–≤–æ–≥–æ `ArchiveManager`, –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ AppointmentEvent

#### –ó–∞–º–µ–Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
```python
# –ó–∞–º–µ–Ω–µ–Ω –∏–º–ø–æ—Ä—Ç
from base.models import ArchivableModel
from base.services import ArchiveManager

# –û–±–Ω–æ–≤–ª–µ–Ω –º–µ–Ω–µ–¥–∂–µ—Ä
objects = ArchiveManager()
```

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è
```python
def _archive_related_records(self, user, reason):
    """–ê—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–∏ AppointmentEvent"""
    # –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å–ª—É—á–∞–π –æ–±—Ä–∞—â–µ–Ω–∏—è
    if self.encounter and not self.encounter.is_archived:
        if hasattr(self.encounter, 'archive'):
            self.encounter.archive(user=user, reason=f"–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: {reason}")

def _restore_related_records(self, user):
    """–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ AppointmentEvent"""
    # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å–ª—É—á–∞–π –æ–±—Ä–∞—â–µ–Ω–∏—è
    if self.encounter and self.encounter.is_archived:
        if hasattr(self.encounter, 'restore'):
            self.encounter.restore(user=user)
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

#### –°–æ–∑–¥–∞–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è: `0003_appointmentevent_archive_reason_and_more.py`
```python
# –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è
+ Add field archive_reason to appointmentevent
+ Add field archived_by to appointmentevent
~ Alter field archived_at on appointmentevent
```

#### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
```bash
python manage.py makemigrations appointments
python manage.py migrate appointments
```

## –ö–∞—Å–∫–∞–¥–Ω–æ–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–∏ `AppointmentEvent` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç—Å—è:
- **–°–≤—è–∑–∞–Ω–Ω—ã–π —Å–ª—É—á–∞–π –æ–±—Ä–∞—â–µ–Ω–∏—è** (`Encounter`) - –µ—Å–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–æ —Å —Å–ª—É—á–∞–µ–º –æ–±—Ä–∞—â–µ–Ω–∏—è

–ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ `AppointmentEvent` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è:
- **–°–≤—è–∑–∞–Ω–Ω—ã–π —Å–ª—É—á–∞–π –æ–±—Ä–∞—â–µ–Ω–∏—è** (`Encounter`) - –µ—Å–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–æ —Å —Å–ª—É—á–∞–µ–º –æ–±—Ä–∞—â–µ–Ω–∏—è

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –æ—à–∏–±–∫–∞ `no such column: appointments_appointmentevent.archived_by_id`
- –ú–æ–¥–µ–ª—å `AppointmentEvent` –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å —Å–∏—Å—Ç–µ–º–æ–π –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è
- –ö–∞—Å–∫–∞–¥–Ω–æ–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π
- –ö–∞—Å–∫–∞–¥–Ω–æ–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –æ–±—Ä–∞—â–µ–Ω–∏—è
- –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **–ú–æ–¥–µ–ª—å:** `AppointmentEvent`
- **–ú–µ–Ω–µ–¥–∂–µ—Ä:** –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `ArchiveManager`
- **–ú–∏–≥—Ä–∞—Ü–∏–∏:** —Å–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –ø–æ–ª–µ–π
- **–ú–µ—Ç–æ–¥—ã:** –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è

## –ú–µ—Ç—Ä–∏–∫–∏

- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 15 –º–∏–Ω—É—Ç
- **–û–±–Ω–æ–≤–ª–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:** 1
- **–°–æ–∑–¥–∞–Ω–æ –º–∏–≥—Ä–∞—Ü–∏–π:** 1
- **–î–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞:** 15+
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—à–∏–±–æ–∫:** 1 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   - `documents` - –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   - `lab_tests` - –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
   - `instrumental_procedures` - –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä

2. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
   - –°–æ–∑–¥–∞–Ω–∏–µ Django Admin –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ–º
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è

3. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è
   - –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è

---

**–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω:** –°–∏—Å—Ç–µ–º–Ω—ã–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä  
**–î–∞—Ç–∞:** 02.09.2025  
**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ documents
