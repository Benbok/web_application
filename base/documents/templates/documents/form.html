{% extends "patients/base.html" %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
<div class="card mt-4">
    <div class="card-body" style="max-width: 600px;">
        <h4 class="card-title mb-4">{{ title }}</h4>
        <form method="post" enctype="multipart/form-data" novalidate>
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary">Сохранить</button>
            <a href="{{ request.GET.next|default:default_back_url }}" class="btn btn-secondary">Отмена</a>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const templateSelect = document.getElementById('id_template_choice');
    if (templateSelect) {
        templateSelect.addEventListener('change', function() {
            const templateId = this.value;
            if (templateId) {
                fetch(`/documents/template-data/${templateId}/`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.title !== undefined) {
                            document.getElementById('id_title').value = data.title;
                        }
                        if (data.content !== undefined) {
                            document.getElementById('id_content').value = data.content;
                        }
                    });
            }
        });
    }
});
</script>
{% endblock %}