{% extends 'patients/base.html' %}
{% load static %}
{% block content %}
<h2>Календарь записей</h2>
<a href="{% url 'appointments:create' %}" class="btn btn-primary mb-3">Создать запись</a>
<div id="calendar"></div>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.css" rel="stylesheet" />
<script src="{% static 'appointments/js/index.global.min.js' %}"></script>
<script src="{% static 'appointments/js/daygrid.global.min.js' %}"></script>
<script src="{% static 'appointments/js/locales-all.global.min.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  var calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
    initialView: 'dayGridMonth',
    locale: 'ru',
    selectable: true,
    events: '{% url "appointments:api_events" %}',
    dateClick: function(info) {
      var date = info.dateStr;
      if (confirm('Добавить запись на ' + date + '?')) {
        window.location.href = "{% url 'appointments:create' %}?date=" + date;
      }
    }
  });
  calendar.render();
});
</script>


<h3 class="mt-4">Список записей</h3>
<table class="table">
  <thead>
    <tr>
      <th>Пациент</th>
      <th>Врач</th>
      <th>Дата и время начала</th>
      <th>Заметки</th>
      <th>Действия</th>
    </tr>
  </thead>
  <tbody>
    {% for appointment in appointments %}
    <tr>
      <td>{{ appointment.patient }}</td>
      <td>{{ appointment.doctor }}</td>
      <td>{{ appointment.start_time|date:"d.m.Y H:i" }}</td>
      <td>{{ appointment.notes|default:"—" }}</td>
      <td>
        <a href="{% url 'appointments:edit' appointment.pk %}" class="btn btn-sm btn-secondary">Редактировать</a>
      </td>

    </tr>
    {% empty %}
    <tr>
      <td colspan="4">Записей пока нет.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}