{% extends 'patients/base.html' %}
{% load static %}
{% block content %}
<h2>Календарь записей</h2>
<a href="{% url 'appointments:create' %}" class="btn btn-primary mb-3">Создать запись</a>
<div id="calendar"></div>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.css" rel="stylesheet" />
<script src="{% static 'appointments/js/index.global.min.js' %}"></script>
<script src="{% static 'appointments/js/daygrid.global.min.js' %}"></script>
<script src="{% static 'appointments/js/locales-all.global.min.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  var calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
    initialView: 'dayGridMonth',
    locale: 'ru',
    events: '{% url "appointments:appointmentevent-list" %}',
  });
  calendar.render();
});
</script>

<h3 class="mt-4">Список записей</h3>
<table class="table">
  <thead>
    <tr>
      <th>Пациент</th>
      <th>Врач</th>
      <th>Дата и время начала</th>
      <th>Заметки</th>
      <th>Статус</th>
    </tr>
  </thead>
  <tbody>
    {% for appointment in appointments %}
    <tr>
      <td>{{ appointment.patient }}</td>
      <td>{{ appointment.doctor }}</td>
      <td>{{ appointment.start|date:"d.m.Y H:i" }}</td>
      <td>{{ appointment.notes|default:"—" }}</td>
      <td>{{ appointment.status }}</td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="5">Записей пока нет.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
