{% extends "patients/base.html" %}
{% block title %}{{ title }} | МедКарт{% endblock %}
{% block page_title %}{{ title }}{% endblock %}

{% block content %}
<div class="card">
    <div class="card-body">
        <h4 class="card-title mb-4">{{ title }}</h4>
        <form method="post" novalidate>
            {% csrf_token %}
            <div class="row">
                <div class="col-md-3">
                    <div class="nav flex-column nav-pills me-3" id="patientTab" role="tablist" aria-orientation="vertical">
                        <button class="nav-link active" id="tab-personal" data-bs-toggle="pill" data-bs-target="#personal" type="button" role="tab">Личные данные</button>
                        <button class="nav-link" id="tab-passport" data-bs-toggle="pill" data-bs-target="#passport" type="button" role="tab">Паспортные данные</button>
                        <button class="nav-link" id="tab-id" data-bs-toggle="pill" data-bs-target="#idinfo" type="button" role="tab">Идентификация</button>
                        <button class="nav-link" id="tab-contacts" data-bs-toggle="pill" data-bs-target="#contacts" type="button" role="tab">Контакты и адреса</button>
                        <button class="nav-link" id="tab-representative" data-bs-toggle="pill" data-bs-target="#representative" type="button" role="tab">Представитель</button>
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="tab-content" id="patientTabContent">
                        <!-- Личные данные -->
                        <div class="tab-pane fade show active" id="personal" role="tabpanel">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.last_name.id_for_label }}" class="form-label">{{ form.last_name.label }}</label>
                                    {{ form.last_name }}
                                    {% for error in form.last_name.errors %}
                                        <div class="text-danger small">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.first_name.id_for_label }}" class="form-label">{{ form.first_name.label }}</label>
                                    {{ form.first_name }}
                                    {% for error in form.first_name.errors %}
                                        <div class="text-danger small">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.middle_name.id_for_label }}" class="form-label">{{ form.middle_name.label }}</label>
                                    {{ form.middle_name }}
                                    {% for error in form.middle_name.errors %}
                                        <div class="text-danger small">{{ error }}</div>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.birth_date.id_for_label }}" class="form-label">{{ form.birth_date.label }}</label>
                                    {{ form.birth_date }}
                                    {% for error in form.birth_date.errors %}
                                        <div class="text-danger small">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.gender.id_for_label }}" class="form-label">{{ form.gender.label }}</label>
                                    {{ form.gender }}
                                    {% for error in form.gender.errors %}
                                        <div class="text-danger small">{{ error }}</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <!-- Паспортные данные -->
                        <div class="tab-pane fade" id="passport" role="tabpanel">
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label for="{{ form.passport_series.id_for_label }}" class="form-label">{{ form.passport_series.label }}</label>
                                    {{ form.passport_series }}
                                    {% for error in form.passport_series.errors %}
                                        <div class="text-danger small">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="{{ form.passport_number.id_for_label }}" class="form-label">{{ form.passport_number.label }}</label>
                                    {{ form.passport_number }}
                                    {% for error in form.passport_number.errors %}
                                        <div class="text-danger small">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.passport_issued_by.id_for_label }}" class="form-label">{{ form.passport_issued_by.label }}</label>
                                    {{ form.passport_issued_by }}
                                    {% for error in form.passport_issued_by.errors %}
                                        <div class="text-danger small">{{ error }}</div>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.passport_issued_date.id_for_label }}" class="form-label">{{ form.passport_issued_date.label }}</label>
                                    {{ form.passport_issued_date }}
                                    {% for error in form.passport_issued_date.errors %}
                                        <div class="text-danger small">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.passport_department_code.id_for_label }}" class="form-label">{{ form.passport_department_code.label }}</label>
                                    {{ form.passport_department_code }}
                                    {% for error in form.passport_department_code.errors %}
                                        <div class="text-danger small">{{ error }}</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <!-- Идентификация -->
                        <div class="tab-pane fade" id="idinfo" role="tabpanel">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.snils.id_for_label }}" class="form-label">{{ form.snils.label }}</label>
                                    {{ form.snils }}
                                    {% for error in form.snils.errors %}
                                        <div class="text-danger small">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.insurance_policy_number.id_for_label }}" class="form-label">{{ form.insurance_policy_number.label }}</label>
                                    {{ form.insurance_policy_number }}
                                    {% for error in form.insurance_policy_number.errors %}
                                        <div class="text-danger small">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.insurance_company.id_for_label }}" class="form-label">{{ form.insurance_company.label }}</label>
                                    {{ form.insurance_company }}
                                    {% for error in form.insurance_company.errors %}
                                        <div class="text-danger small">{{ error }}</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <!-- Контакты и адреса -->
                        <div class="tab-pane fade" id="contacts" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.phone.id_for_label }}" class="form-label">{{ form.phone.label }}</label>
                                    {{ form.phone }}
                                    {% for error in form.phone.errors %}
                                        <div class="text-danger small">{{ error }}</div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.email.id_for_label }}" class="form-label">{{ form.email.label }}</label>
                                    {{ form.email }}
                                    {% for error in form.email.errors %}
                                        <div class="text-danger small">{{ error }}</div>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="{{ form.registration_address.id_for_label }}" class="form-label">{{ form.registration_address.label }}</label>
                                {{ form.registration_address }}
                                {% for error in form.registration_address.errors %}
                                    <div class="text-danger small">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="mb-3">
                                <label for="{{ form.residential_address.id_for_label }}" class="form-label">{{ form.residential_address.label }}</label>
                                {{ form.residential_address }}
                                {% for error in form.residential_address.errors %}
                                    <div class="text-danger small">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Представитель -->
                        <div class="tab-pane fade" id="representative" role="tabpanel">
                            <div class="mb-3">
                                <label for="{{ form.legal_representative_full_name.id_for_label }}" class="form-label">{{ form.legal_representative_full_name.label }}</label>
                                {{ form.legal_representative_full_name }}
                                {% for error in form.legal_representative_full_name.errors %}
                                    <div class="text-danger small">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="mb-3">
                                <label for="{{ form.legal_representative_relation.id_for_label }}" class="form-label">{{ form.legal_representative_relation.label }}</label>
                                {{ form.legal_representative_relation }}
                                {% for error in form.legal_representative_relation.errors %}
                                    <div class="text-danger small">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="mb-3">
                                <label for="{{ form.legal_representative_contacts.id_for_label }}" class="form-label">{{ form.legal_representative_contacts.label }}</label>
                                {{ form.legal_representative_contacts }}
                                {% for error in form.legal_representative_contacts.errors %}
                                    <div class="text-danger small">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-between align-items-center mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-1"></i> Сохранить
                </button>
                {% if patient %}
                    <a href="{% url 'patients:patient_detail' patient.pk %}" class="btn btn-outline-secondary">
                        <i class="fas fa-times me-1"></i> Отмена
                    </a>
                {% else %}
                    <a href="{% url 'patients:patient_list' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-times me-1"></i> Отмена
                    </a>
                {% endif %}
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    Inputmask("+7 (999) 999-99-99").mask(document.getElementById("id_phone")); // телефон
    Inputmask("999-999-999 99").mask(document.getElementById("id_snils")); // СНИЛС
    Inputmask("9999").mask(document.getElementById("id_passport_series")); // Серия паспорта
    Inputmask("999999").mask(document.getElementById("id_passport_number")); // Номер паспорта
    Inputmask("999-999").mask(document.getElementById("id_passport_department_code")); // код подразделения
});
</script>

{% endblock %}