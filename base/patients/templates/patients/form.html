{% extends "patients/base.html" %}
{% block title %}{{ title }} | МедКарт{% endblock %}
{% block page_title %}{{ title }}{% endblock %}

{% block content %}
<div class="card">
    <div class="card-body">
        <h4 class="card-title mb-4">{{ title }}</h4>
        <form method="post" novalidate>
            {% csrf_token %}

            <!-- ФИО -->
            <h5 class="mt-3 mb-2">Личные данные</h5>
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="{{ form.family.id_for_label }}" class="form-label">{{ form.family.label }}</label>
                    {{ form.family }}
                    {% for error in form.family.errors %}
                        <div class="text-danger small">{{ error }}</div>
                    {% endfor %}
                </div>
                <div class="col-md-4 mb-3">
                    <label for="{{ form.given.id_for_label }}" class="form-label">{{ form.given.label }}</label>
                    {{ form.given }}
                    {% for error in form.given.errors %}
                        <div class="text-danger small">{{ error }}</div>
                    {% endfor %}
                </div>
                <div class="col-md-4 mb-3">
                    <label for="{{ form.middle.id_for_label }}" class="form-label">{{ form.middle.label }}</label>
                    {{ form.middle }}
                    {% for error in form.middle.errors %}
                        <div class="text-danger small">{{ error }}</div>
                    {% endfor %}
                </div>
            </div>

            <!-- Дата рождения и пол -->
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="{{ form.birth_date.id_for_label }}" class="form-label">{{ form.birth_date.label }}</label>
                    {{ form.birth_date }}
                    {% for error in form.birth_date.errors %}
                        <div class="text-danger small">{{ error }}</div>
                    {% endfor %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.gender.id_for_label }}" class="form-label">{{ form.gender.label }}</label>
                    {{ form.gender }}
                    {% for error in form.gender.errors %}
                        <div class="text-danger small">{{ error }}</div>
                    {% endfor %}
                </div>
            </div>

            <hr>

            <!-- Контакты -->
            <h5 class="mt-3 mb-2">Контактная информация</h5>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="{{ form.phone.id_for_label }}" class="form-label">{{ form.phone.label }}</label>
                    {{ form.phone }}
                    {% for error in form.phone.errors %}
                        <div class="text-danger small">{{ error }}</div>
                    {% endfor %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.email.id_for_label }}" class="form-label">{{ form.email.label }}</label>
                    {{ form.email }}
                    {% for error in form.email.errors %}
                        <div class="text-danger small">{{ error }}</div>
                    {% endfor %}
                </div>
            </div>

            <!-- Адрес -->
            <div class="mb-3">
                <label for="{{ form.address_text.id_for_label }}" class="form-label">{{ form.address_text.label }}</label>
                {{ form.address_text }}
                {% for error in form.address_text.errors %}
                    <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="{{ form.postal_code.id_for_label }}" class="form-label">{{ form.postal_code.label }}</label>
                    {{ form.postal_code }}
                    {% for error in form.postal_code.errors %}
                        <div class="text-danger small">{{ error }}</div>
                    {% endfor %}
                </div>
                <div class="col-md-4 mb-3">
                    <label for="{{ form.city.id_for_label }}" class="form-label">{{ form.city.label }}</label>
                    {{ form.city }}
                    {% for error in form.city.errors %}
                        <div class="text-danger small">{{ error }}</div>
                    {% endfor %}
                </div>
                <div class="col-md-4 mb-3">
                    <label for="{{ form.country.id_for_label }}" class="form-label">{{ form.country.label }}</label>
                    {{ form.country }}
                    {% for error in form.country.errors %}
                        <div class="text-danger small">{{ error }}</div>
                    {% endfor %}
                </div>
            </div>

            <hr>

            <!-- Документы -->
            <h5 class="mt-3 mb-2">Документы</h5>
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="{{ form.snils.id_for_label }}" class="form-label">{{ form.snils.label }}</label>
                    {{ form.snils }}
                    {% for error in form.snils.errors %}
                        <div class="text-danger small">{{ error }}</div>
                    {% endfor %}
                </div>
                <div class="col-md-4 mb-3">
                    <label for="{{ form.insurance_policy.id_for_label }}" class="form-label">{{ form.insurance_policy.label }}</label>
                    {{ form.insurance_policy }}
                    {% for error in form.insurance_policy.errors %}
                        <div class="text-danger small">{{ error }}</div>
                    {% endfor %}
                </div>
                <div class="col-md-4 mb-3">
                    <label for="{{ form.passport_number.id_for_label }}" class="form-label">{{ form.passport_number.label }}</label>
                    {{ form.passport_number }}
                    {% for error in form.passport_number.errors %}
                        <div class="text-danger small">{{ error }}</div>
                    {% endfor %}
                </div>
            </div>

            <hr>

            <!-- Медицинская информация -->
            <h5 class="mt-3 mb-2">Медицинская информация</h5>
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="{{ form.blood_type.id_for_label }}" class="form-label">{{ form.blood_type.label }}</label>
                    {{ form.blood_type }}
                    {% for error in form.blood_type.errors %}
                        <div class="text-danger small">{{ error }}</div>
                    {% endfor %}
                </div>
                <div class="col-md-4 mb-3">
                    <label for="{{ form.rhesus_factor.id_for_label }}" class="form-label">{{ form.rhesus_factor.label }}</label>
                    {{ form.rhesus_factor }}
                    {% for error in form.rhesus_factor.errors %}
                        <div class="text-danger small">{{ error }}</div>
                    {% endfor %}
                </div>
                <div class="col-md-4 mb-3">
                    <label for="{{ form.deceased.id_for_label }}" class="form-label">{{ form.deceased.label }}</label>
                    {{ form.deceased }}
                    {% for error in form.deceased.errors %}
                        <div class="text-danger small">{{ error }}</div>
                    {% endfor %}
                </div>
            </div>
            <div class="mb-3">
                <label for="{{ form.allergies.id_for_label }}" class="form-label">{{ form.allergies.label }}</label>
                {{ form.allergies }}
                {% for error in form.allergies.errors %}
                    <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
            <div class="mb-3">
                <label for="{{ form.chronic_conditions.id_for_label }}" class="form-label">{{ form.chronic_conditions.label }}</label>
                {{ form.chronic_conditions }}
                {% for error in form.chronic_conditions.errors %}
                    <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>

            <div class="d-flex justify-content-between align-items-center mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-1"></i> Сохранить
                </button>
                {% if patient %}
                    <a href="{% url 'patient_detail' patient.pk %}" class="btn btn-outline-secondary">
                        <i class="fas fa-times me-1"></i> Отмена
                    </a>
                {% else %}
                    <a href="{% url 'patient_list' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-times me-1"></i> Отмена
                    </a>
                {% endif %}
            </div>
        </form>
    </div>
</div>
{% endblock %}